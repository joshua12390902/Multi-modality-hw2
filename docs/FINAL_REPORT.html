<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <title>醫學影像壓縮編碼系統 - 技術報告</title>
    <style>
    @page {
        size: A4;
        margin: 1.5cm 1.2cm;
    }
    
    body {
        font-family: 'Noto Sans CJK TC', 'Noto Sans CJK SC', sans-serif;
        font-size: 10pt;
        line-height: 1.4;
        color: #333;
    }
    
    h1 {
        font-size: 20pt;
        color: #2c3e50;
        border-bottom: 2.5pt solid #3498db;
        padding-bottom: 6pt;
        margin: 16pt 0 10pt 0;
        page-break-after: avoid;
    }
    
    h2 {
        font-size: 15pt;
        color: #34495e;
        border-bottom: 1.5pt solid #bdc3c7;
        padding-bottom: 4pt;
        margin: 14pt 0 8pt 0;
        page-break-after: avoid;
    }
    
    h3 {
        font-size: 12pt;
        color: #555;
        margin: 10pt 0 6pt 0;
        page-break-after: avoid;
    }
    
    h4 {
        font-size: 11pt;
        color: #666;
        margin: 8pt 0 4pt 0;
    }
    
    p {
        margin: 4pt 0;
    }
    
    table {
        border-collapse: collapse;
        width: 100%;
        margin: 8pt 0;
        font-size: 9pt;
        page-break-inside: avoid;
    }
    
    th, td {
        border: 0.5pt solid #ddd;
        padding: 4pt 6pt;
        text-align: left;
    }
    
    th {
        background-color: #3498db;
        color: white;
        font-weight: bold;
    }
    
    tr:nth-child(even) {
        background-color: #f8f9fa;
    }
    
    code {
        background-color: #f4f4f4;
        padding: 1pt 3pt;
        font-family: 'Courier New', monospace;
        font-size: 8.5pt;
        color: #c7254e;
    }
    
    pre {
        background-color: #f8f8f8;
        border: 0.5pt solid #ddd;
        padding: 6pt;
        font-size: 8pt;
        line-height: 1.3;
        page-break-inside: avoid;
        margin: 6pt 0;
    }
    
    pre code {
        background: none;
        padding: 0;
        color: #333;
    }
    
    ul, ol {
        margin: 4pt 0;
        padding-left: 18pt;
    }
    
    li {
        margin: 2pt 0;
    }
    
    hr {
        border: none;
        border-top: 1.5pt solid #bdc3c7;
        margin: 12pt 0;
    }
    
    strong {
        font-weight: 600;
        color: #2c3e50;
    }
    </style>
</head>
<body>
<h1 id="醫學影像壓縮編碼系統-技術報告">醫學影像壓縮編碼系統 - 技術報告</h1>

<p><strong>課程</strong>: 多模態影像處理<br />
<strong>學號</strong>: 314831024<br />
<strong>姓名</strong>: 李朋逸<br />
<strong>日期</strong>: 2026年1月3日<br />
<strong>GitHub</strong>: https://github.com/joshua12390902/Multi-modality-hw2<br />
<strong>GitHub</strong>: https://github.com/joshua12390902/Multi-modality-hw2</p>

<hr />

<h2 id="1-系統概要">1. 系統概要</h2>

<p>本系統實現了一套完整的16-bit醫學影像有損壓縮編碼器，結合DCT轉換、量化與Huffman熵編碼，能有效壓縮真實CT影像同時保持診斷品質。</p>

<h3 id="核心規格">核心規格</h3>

<table>
<thead>
<tr>
  <th>項目</th>
  <th>規格</th>
</tr>
</thead>
<tbody>
<tr>
  <td>支援影像</td>
  <td>12-16 bit醫學影像（CT/MRI）</td>
</tr>
<tr>
  <td>壓縮率</td>
  <td>14.5-15.6:1</td>
</tr>
<tr>
  <td>PSNR範圍</td>
  <td>49-61 dB（Quality 30-90）</td>
</tr>
<tr>
  <td>檔案格式</td>
  <td>自訂二進位格式 (.mdc)</td>
</tr>
</tbody>
</table>

<hr />

<h2 id="2-系統架構">2. 系統架構</h2>

<h3 id="21-編碼流程">2.1 編碼流程</h3>

<pre><code>原始影像 → 填充至8×8倍數 → DCT轉換 → 量化 → Zigzag掃描 → Huffman編碼 → 位元流
</code></pre>

<h3 id="22-解碼流程">2.2 解碼流程</h3>

<pre><code>位元流 → Huffman解碼 → 反Zigzag → 反量化 → 反DCT → 移除填充 → 重建影像
</code></pre>

<hr />

<h2 id="3-技術實現">3. 技術實現</h2>

<h3 id="31-dct轉換">3.1 DCT轉換</h3>

<p>對8×8區塊應用離散餘弦轉換，將空間域轉換為頻率域。</p>

<p><strong>數學原理</strong>：</p>

<p>2D DCT公式：F(u,v) = (2/N) × C(u) × C(v) × Σ(x=0到7) Σ(y=0到7) f(x,y) × cos[π(2x+1)u/16] × cos[π(2y+1)v/16]</p>

<p>其中 C(u) = 1/√2（當u=0），否則 C(u) = 1</p>

<p><strong>實現細節</strong>：</p>

<ul>
<li>使用scipy.fftpack.dct實現，採用正交化DCT-II</li>
<li>分離式轉換：先對行做1D DCT，再對列做1D DCT</li>
<li>計算複雜度：O(N² log N)，比直接計算O(N⁴)快得多</li>
<li>數值穩定性：使用浮點64位運算保證精度</li>
</ul>

<p><strong>頻率分佈特性</strong>：</p>

<ul>
<li>DC係數（左上角）：代表區塊平均值，能量最高</li>
<li>低頻（左上區域）：包含主要影像資訊</li>
<li>高頻（右下區域）：包含邊緣細節，能量較低</li>
<li>量化時優先保留低頻，高頻可適度捨棄</li>
</ul>

<h3 id="32-量化矩陣">3.2 量化矩陣</h3>

<p>基於JPEG標準量化矩陣，針對16-bit醫學影像擴展。</p>

<p><strong>品質調整公式</strong>：</p>

<ul>
<li>Quality &lt; 50: scale = 5000 / quality</li>
<li>Quality ≥ 50: scale = 200 - 2 × quality</li>
<li>bit_scale = 256（16-bit vs 8-bit縮放因子）</li>
<li>Q<em>final = clip(floor((Q</em>base × scale × bit_scale + 50) / 100), 1, 65535)</li>
</ul>

<p><strong>完整量化矩陣(8×8)</strong>：</p>

<pre><code>  16   11   10   16   24   40   51   61
  12   12   14   19   26   58   60   55
  14   13   16   24   40   57   69   56
  14   17   22   29   51   87   80   62
  18   22   37   56   68  109  103   77
  24   35   55   64   81  104  113   92
  49   64   78   87  103  121  120  101
  72   92   95   98  112  100  103   99
</code></pre>

<p><strong>設計理念</strong>：</p>

<ul>
<li>左上角數值小（精細量化，保留低頻）</li>
<li>右下角數值大（粗糙量化，壓縮高頻）</li>
<li>對角線遞增（頻率越高，量化越粗）</li>
<li>醫學影像調整：比標準JPEG矩陣乘以256倍</li>
</ul>

<p><strong>量化效果範例</strong>（Quality=60）：</p>

<ul>
<li>低頻係數：量化步長 ~50-100（保留細節）</li>
<li>中頻係數：量化步長 ~200-500（適度壓縮）</li>
<li>高頻係數：量化步長 ~800-1500（大幅壓縮）</li>
</ul>

<h3 id="33-huffman編碼">3.3 Huffman編碼</h3>

<p>採用變長編碼，實現無損熵壓縮。</p>

<p><strong>演算法步驟</strong>：</p>

<ol>
<li><strong>建立頻率表</strong> - 統計所有量化係數出現次數</li>
<li><strong>構建Huffman樹</strong>：
<ul>
<li>將所有係數按頻率排序</li>
<li>反覆合併頻率最低的兩個節點</li>
<li>直到只剩一個根節點</li>
</ul></li>
<li><strong>生成碼字</strong>：
<ul>
<li>左分支=0，右分支=1</li>
<li>葉節點路徑即為碼字</li>
</ul></li>
<li><strong>編碼資料</strong> - 用碼字替換原始係數</li>
</ol>

<p><strong>編碼效率</strong>：</p>

<ul>
<li>常見係數（如0）：使用短碼（2-4 bits）</li>
<li>稀有係數：使用長碼（10-16 bits）</li>
<li>平均碼長：約5-7 bits（vs 固定16 bits）</li>
<li>壓縮增益：~2.5-3× 額外壓縮</li>
</ul>

<p><strong>碼表序列化格式</strong>：</p>

<pre><code>[碼表大小: 2 bytes]
[符號1: 4 bytes][碼長1: 1 byte][碼字1: variable]
[符號2: 4 bytes][碼長2: 1 byte][碼字2: variable]
...
</code></pre>

<h3 id="34-zigzag掃描">3.4 Zigzag掃描</h3>

<p>將8×8矩陣係數重排為1D序列，使相似值聚集。</p>

<p><strong>掃描順序</strong>：</p>

<pre><code> 0  1  5  6 14 15 27 28
 2  4  7 13 16 26 29 42
 3  8 12 17 25 30 41 43
 9 11 18 24 31 40 44 53
10 19 23 32 39 45 52 54
20 22 33 38 46 51 55 60
21 34 37 47 50 56 59 61
35 36 48 49 57 58 62 63
</code></pre>

<p><strong>優勢</strong>：</p>

<ul>
<li>低頻（左上）先掃，高頻（右下）後掃</li>
<li>量化後高頻多為0，形成長串0</li>
<li>配合RLE（Run-Length Encoding）可進一步壓縮</li>
</ul>

<h3 id="35-位元流格式">3.5 位元流格式</h3>

<p><strong>完整檔案結構</strong>：</p>

<pre><code>[標頭區 - 12 bytes]
  位元 0-31:   魔數 "MEDC" (4 bytes)
  位元 32-39:  版本 0x01 (1 byte)
  位元 40-55:  寬度 (uint16, Big-endian)
  位元 56-71:  高度 (uint16, Big-endian)
  位元 72-79:  位元深度 (uint8)
  位元 80-87:  區塊大小 (uint8, =8)
  位元 88-95:  品質參數 (uint8, 1-100)

[量化矩陣區]
  位元 96-111:   量化矩陣大小 (uint16) = 128 bytes
  位元 112-1135: 量化矩陣 (64 × uint16 entries)

[Huffman碼表區]
  位元 N-N+15:   碼表大小 (uint16)
  位元 N+16+:    碼表序列化資料

[編碼資料區]
  位元 M-M+31:   編碼位元數 (uint32)
  位元 M+32+63:  編碼資料大小 (uint32, bytes)
  位元 M+64+:    Huffman編碼係數 (variable length)
</code></pre>

<p><strong>設計特點</strong>：</p>

<ul>
<li>Big-endian編碼：跨平台相容</li>
<li>自包含：所有解碼參數都在檔案內</li>
<li>可擴展：版本號支援未來格式更新</li>
<li>驗證機制：魔數"MEDC"防止誤讀</li>
</ul>

<hr />

<h2 id="4-實驗結果">4. 實驗結果</h2>

<h3 id="41-測試資料">4.1 測試資料</h3>

<p><strong>資料集</strong>: Medimodel Human<em>Skull</em>2 CT<br />
<strong>規格</strong>: 512×512, 16-bit, JPEG Lossless DICOM<br />
<strong>評估切片</strong>: I50, I100, I150, I200, I250（5張代表性切片）</p>

<h3 id="42-性能摘要">4.2 性能摘要</h3>

<table>
<thead>
<tr>
  <th>Quality</th>
  <th>壓縮大小</th>
  <th>bpp</th>
  <th>壓縮率</th>
  <th>PSNR (dB)</th>
  <th>SSIM</th>
  <th>邊緣PSNR</th>
</tr>
</thead>
<tbody>
<tr>
  <td><strong>30</strong></td>
  <td>33,540 B</td>
  <td>1.024</td>
  <td>15.63:1</td>
  <td><strong>49.14</strong></td>
  <td>0.9810</td>
  <td>21.00</td>
</tr>
<tr>
  <td><strong>60</strong></td>
  <td>34,027 B</td>
  <td>1.038</td>
  <td>15.41:1</td>
  <td><strong>50.96</strong></td>
  <td>0.9857</td>
  <td>24.64</td>
</tr>
<tr>
  <td><strong>90</strong></td>
  <td>36,222 B</td>
  <td>1.105</td>
  <td>14.48:1</td>
  <td><strong>61.22</strong></td>
  <td>0.9986</td>
  <td>31.26</td>
</tr>
</tbody>
</table>

<p><strong>解讀</strong>：</p>

<ul>
<li>PSNR &gt; 50 dB：高品質，無視覺差異</li>
<li>SSIM &gt; 0.98：結構相似度極高</li>
<li>原始大小：524,288 bytes → 壓縮後：~34KB</li>
</ul>

<p><strong>效能比較圖</strong>：</p>

<p><img src="../results_real/performance_comparison.png" alt="效能比較" /></p>

<p>圖1：三種品質等級（Q30/Q60/Q90）的PSNR、壓縮率、比特率比較。Q60提供最佳平衡點。</p>

<p><img src="../results_real/performance_comparison.png" alt="性能比較圖" />
<em>圖1：三種品質設定下的PSNR、壓縮率與比特率比較</em></p>

<p><img src="../results_real/rate_distortion_curve.png" alt="Rate-Distortion曲線" />
<em>圖2：Rate-Distortion曲線 - 壓縮率與PSNR的權衡關係</em></p>

<h3 id="43-切片級結果">4.3 切片級結果</h3>

<p><strong>I50切片（額部區域）</strong>範圍[-3024, 2269]：</p>

<table>
<thead>
<tr>
  <th>Quality</th>
  <th>壓縮(bytes)</th>
  <th>bpp</th>
  <th>比率</th>
  <th>PSNR</th>
  <th>SSIM</th>
</tr>
</thead>
<tbody>
<tr>
  <td>30</td>
  <td>33,786</td>
  <td>1.031</td>
  <td>15.52:1</td>
  <td>46.66 dB</td>
  <td>0.9742</td>
</tr>
<tr>
  <td>60</td>
  <td>34,669</td>
  <td>1.058</td>
  <td>15.12:1</td>
  <td>50.38 dB</td>
  <td>0.9866</td>
</tr>
<tr>
  <td>90</td>
  <td>38,109</td>
  <td>1.163</td>
  <td>13.76:1</td>
  <td>57.27 dB</td>
  <td>0.9977</td>
</tr>
</tbody>
</table>

<p><strong>I100切片（上顎區域）</strong>範圍[-3024, 381]：</p>

<table>
<thead>
<tr>
  <th>Quality</th>
  <th>壓縮(bytes)</th>
  <th>bpp</th>
  <th>比率</th>
  <th>PSNR</th>
  <th>SSIM</th>
</tr>
</thead>
<tbody>
<tr>
  <td>30</td>
  <td>33,692</td>
  <td>1.028</td>
  <td>15.56:1</td>
  <td>47.96 dB</td>
  <td>0.9846</td>
</tr>
<tr>
  <td>60</td>
  <td>34,129</td>
  <td>1.042</td>
  <td>15.36:1</td>
  <td>50.54 dB</td>
  <td>0.9866</td>
</tr>
<tr>
  <td>90</td>
  <td>36,178</td>
  <td>1.104</td>
  <td>14.49:1</td>
  <td>58.51 dB</td>
  <td>0.9987</td>
</tr>
</tbody>
</table>

<p><strong>I150切片（眼窩區域）</strong>範圍[-1024, 1879]：</p>

<table>
<thead>
<tr>
  <th>Quality</th>
  <th>壓縮(bytes)</th>
  <th>bpp</th>
  <th>比率</th>
  <th>PSNR</th>
  <th>SSIM</th>
</tr>
</thead>
<tbody>
<tr>
  <td>30</td>
  <td>33,393</td>
  <td>1.019</td>
  <td>15.70:1</td>
  <td>50.42 dB</td>
  <td>0.9826</td>
</tr>
<tr>
  <td>60</td>
  <td>33,754</td>
  <td>1.030</td>
  <td>15.53:1</td>
  <td>51.32 dB</td>
  <td>0.9852</td>
</tr>
<tr>
  <td>90</td>
  <td>35,668</td>
  <td>1.089</td>
  <td>14.70:1</td>
  <td>62.88 dB</td>
  <td>0.9988</td>
</tr>
</tbody>
</table>

<p><strong>I200切片（中頭部區域）</strong>範圍[-1024, 1770]：</p>

<table>
<thead>
<tr>
  <th>Quality</th>
  <th>壓縮(bytes)</th>
  <th>bpp</th>
  <th>比率</th>
  <th>PSNR</th>
  <th>SSIM</th>
</tr>
</thead>
<tbody>
<tr>
  <td>30</td>
  <td>33,441</td>
  <td>1.021</td>
  <td>15.68:1</td>
  <td>50.77 dB</td>
  <td>0.9839</td>
</tr>
<tr>
  <td>60</td>
  <td>33,736</td>
  <td>1.030</td>
  <td>15.54:1</td>
  <td>51.19 dB</td>
  <td>0.9845</td>
</tr>
<tr>
  <td>90</td>
  <td>35,292</td>
  <td>1.077</td>
  <td>14.86:1</td>
  <td>64.77 dB</td>
  <td>0.9992</td>
</tr>
</tbody>
</table>

<p><strong>I250切片（下頜部區域）</strong>範圍[-1024, 1920]：</p>

<table>
<thead>
<tr>
  <th>Quality</th>
  <th>壓縮(bytes)</th>
  <th>bpp</th>
  <th>比率</th>
  <th>PSNR</th>
  <th>SSIM</th>
</tr>
</thead>
<tbody>
<tr>
  <td>30</td>
  <td>33,388</td>
  <td>1.019</td>
  <td>15.70:1</td>
  <td>49.91 dB</td>
  <td>0.9799</td>
</tr>
<tr>
  <td>60</td>
  <td>33,847</td>
  <td>1.033</td>
  <td>15.49:1</td>
  <td>51.37 dB</td>
  <td>0.9857</td>
</tr>
<tr>
  <td>90</td>
  <td>35,862</td>
  <td>1.094</td>
  <td>14.62:1</td>
  <td>62.65 dB</td>
  <td>0.9987</td>
</tr>
</tbody>
</table>

<p><strong>觀察</strong>：</p>

<ul>
<li>不同解剖位置表現穩定，壓縮率變異 &lt; 1%</li>
<li>I150/I200/I250（中下部）PSNR較高（更均勻組織）</li>
<li>I50（含顱骨與空氣）PSNR稍低但仍達46+ dB</li>
</ul>

<p><strong>各切片詳細結果</strong>：</p>

<p><img src="../results_real/slice_details.png" alt="切片詳細結果" /></p>

<p>圖2：五張切片（I50/I100/I150/I200/I250）在三種品質設定下的PSNR表現。</p>

<p><img src="../results_real/slice_details.png" alt="各切片詳細結果" />
<em>圖3：5個切片在3種品質下的PSNR表現</em></p>

<h3 id="44-定性分析">4.4 定性分析</h3>

<p>以I150切片、Quality=60為例：</p>

<p><img src="../results_real/qualitative_I150_Q60.png" alt="定性重建結果" />
<em>圖4：I150切片定性結果 - 左：原始影像，中：重建影像，右：誤差圖</em></p>

<p><strong>視覺品質評估</strong>：</p>

<ul>
<li>重建影像與原始影像視覺差異極小</li>
<li>骨骼結構（眼窩、顱骨）邊界清晰保留</li>
<li>軟組織細節完整，無明顯模糊</li>
<li>誤差主要集中於高頻邊緣，無明顯臨床結構遺失</li>
</ul>

<p><strong>誤差分佈特性</strong>：</p>

<ul>
<li>絕對誤差範圍：0-500（以99.5分位縮放）</li>
<li>高誤差區域：骨骼-空氣交界處（高頻邊緣）</li>
<li>低誤差區域：均勻軟組織（低頻區域）</li>
<li>平均絕對誤差：約80-100 HU</li>
</ul>

<p><strong>臨床可接受性</strong>：</p>

<ul>
<li>解剖結構完整可辨識</li>
<li>無偽影干擾診斷</li>
<li>適用於影像存檔與傳輸</li>
<li>不建議用於精確測量（使用無損格式）</li>
</ul>

<p><strong>定性重建結果</strong>：</p>

<p><img src="../results_real/qualitative_I150_Q60.png" alt="定性結果" /></p>

<p>圖3：I150切片、Quality=60的定性結果。左：原始影像；中：重建影像；右：誤差圖（絕對差）。重建影像與原始影像視覺差異極小，誤差主要分佈於高頻邊緣區域。</p>

<h3 id="45-穩定性分析">4.5 穩定性分析</h3>

<p><strong>跨切片一致性</strong>（5張切片）：</p>

<table>
<thead>
<tr>
  <th>Quality</th>
  <th>PSNR 標準差</th>
  <th>壓縮率 標準差</th>
  <th>SSIM 標準差</th>
</tr>
</thead>
<tbody>
<tr>
  <td>30</td>
  <td>1.38 dB</td>
  <td>0.075:1</td>
  <td>0.0047</td>
</tr>
<tr>
  <td>60</td>
  <td>0.44 dB</td>
  <td>0.025:1</td>
  <td>0.0021</td>
</tr>
<tr>
  <td>90</td>
  <td>2.47 dB</td>
  <td>0.085:1</td>
  <td>0.0015</td>
</tr>
</tbody>
</table>

<p><strong>觀察</strong>：</p>

<ul>
<li>Quality 60 表現最穩定（最小標準差）</li>
<li>不同解剖位置（額部、上顎、眼窩等）性能一致</li>
<li>SSIM標準差 &lt; 0.005，結構保留度極為穩定</li>
<li>系統對影像內容變化具有良好魯棒性</li>
</ul>

<p><strong>影像複雜度影響</strong>：</p>

<ul>
<li>I50（含大量空氣與骨骼）：PSNR較低（46 dB）但壓縮率最高</li>
<li>I150-I250（均勻軟組織）：PSNR最高（62-64 dB）且穩定</li>
<li>結論：複雜影像獲得更高壓縮率，但PSNR略低</li>
</ul>

<h3 id="46-消融實驗huffman編碼貢獻">4.6 消融實驗：Huffman編碼貢獻</h3>

<p>評估Huffman熵編碼的實際效益。</p>

<p><strong>實驗設定</strong>：</p>

<ul>
<li>基準：僅量化（儲存16-bit係數）</li>
<li>實驗組：量化 + Huffman編碼</li>
</ul>

<table>
<thead>
<tr>
  <th>設定</th>
  <th>檔案大小</th>
  <th>壓縮率</th>
  <th>PSNR</th>
  <th>額外壓縮</th>
</tr>
</thead>
<tbody>
<tr>
  <td>僅量化（理論）</td>
  <td>~524,288 B</td>
  <td>1.0:1</td>
  <td>50.96 dB</td>
  <td>-</td>
</tr>
<tr>
  <td>Huffman（本系統）</td>
  <td>34,027 B</td>
  <td>15.41:1</td>
  <td>50.96 dB</td>
  <td><strong>15.4×</strong></td>
</tr>
</tbody>
</table>

<p><strong>分析</strong>：</p>

<ul>
<li>Huffman提供15×額外壓縮，且不影響失真度（PSNR相同）</li>
<li>若無Huffman，量化後檔案仍達512KB（原始大小）</li>
<li>熵編碼是實現高壓縮率的關鍵技術</li>
<li>編碼時間僅增加5-10 ms，性價比極高</li>
</ul>

<p><strong>係數分佈特性</strong>（Q=60）：</p>

<ul>
<li>零係數佔比：約60-70%（經量化後）</li>
<li>小係數（±1~±10）：約20%</li>
<li>大係數（±100+）：約5%</li>
<li>稀疏性使Huffman編碼高效</li>
</ul>

<h3 id="47-rate-distortion權衡分析">4.7 Rate-Distortion權衡分析</h3>

<p><strong>最佳工作點選擇</strong>：</p>

<table>
<thead>
<tr>
  <th>Quality</th>
  <th>用途場景</th>
  <th>優勢</th>
  <th>劣勢</th>
</tr>
</thead>
<tbody>
<tr>
  <td>30</td>
  <td>遠端傳輸、低頻寬</td>
  <td>最高壓縮率</td>
  <td>PSNR接近臨界</td>
</tr>
<tr>
  <td><strong>60</strong></td>
  <td><strong>標準存檔</strong></td>
  <td><strong>平衡最佳</strong></td>
  <td>-</td>
</tr>
<tr>
  <td>90</td>
  <td>高品質診斷參考</td>
  <td>極高PSNR</td>
  <td>壓縮率略低</td>
</tr>
</tbody>
</table>

<p><strong>推薦配置</strong>：</p>

<ul>
<li>常規存檔：Quality 60（50.96 dB, 15.41:1）</li>
<li>緊急傳輸：Quality 40（約48 dB, 16:1）</li>
<li>精密診斷：Quality 80（約58 dB, 14.5:1）</li>
<li>原則：PSNR &gt; 45 dB 即可滿足大多數臨床需求</li>
</ul>

<p><strong>Rate-Distortion曲線</strong>：</p>

<p><img src="../results_real/rate_distortion_curve.png" alt="Rate-Distortion曲線" /></p>

<p>圖4：壓縮率vs PSNR的權衡曲線。三個品質點（Q30/Q60/Q90）展示了從高壓縮到高品質的連續選擇空間。</p>

<hr />

<h2 id="5-設計亮點">5. 設計亮點</h2>

<h3 id="51-醫學影像優化">5.1 醫學影像優化</h3>

<ol>
<li><strong>16-bit支援</strong>：量化矩陣擴展至16-bit範圍（bit_scale=256）</li>
<li><strong>DICOM相容</strong>：使用SimpleITK處理JPEG Lossless轉移語法</li>
<li><strong>自適應量化</strong>：品質參數靈活調整壓縮率與失真度平衡</li>
</ol>

<p><strong>技術創新</strong>：</p>

<ul>
<li>擴展JPEG標準量化矩陣至醫學影像位元深度</li>
<li>直接支援DICOM格式，無需預處理</li>
<li>Quality參數範圍1-100，覆蓋存儲到診斷的各種需求</li>
</ul>

<h3 id="52-自包含位元流">5.2 自包含位元流</h3>

<ul>
<li>解碼器無需外部配置</li>
<li>魔數驗證防止誤讀</li>
<li>版本號支援未來擴展</li>
</ul>

<p><strong>設計優勢</strong>：</p>

<ul>
<li>單一檔案包含所有解碼資訊</li>
<li>跨平台可移植性高</li>
<li>支援流式解碼（未來擴展）</li>
</ul>

<h3 id="53-額外評估指標">5.3 額外評估指標</h3>

<ul>
<li><strong>SSIM</strong>：全域結構相似度（0.981-0.999）</li>
<li><strong>邊緣PSNR</strong>：基於Sobel梯度，衡量邊緣保留度（21-31 dB）</li>
</ul>

<p><strong>臨床意義</strong>：</p>

<ul>
<li>SSIM評估感知品質（更接近人眼判斷）</li>
<li>邊緣PSNR確保解剖結構邊界清晰</li>
<li>雙重指標保證診斷可靠性</li>
</ul>

<h3 id="54-效能指標">5.4 效能指標</h3>

<table>
<thead>
<tr>
  <th>指標</th>
  <th>數值</th>
  <th>評價</th>
</tr>
</thead>
<tbody>
<tr>
  <td>編碼速度</td>
  <td>~50-100 ms/切片</td>
  <td>實時可行</td>
</tr>
<tr>
  <td>解碼速度</td>
  <td>~30-50 ms/切片</td>
  <td>高效</td>
</tr>
<tr>
  <td>記憶體用量</td>
  <td>~10-20 MB/切片</td>
  <td>可接受</td>
</tr>
<tr>
  <td>壓縮率穩定性</td>
  <td>±0.7%</td>
  <td>穩定</td>
</tr>
</tbody>
</table>

<p><strong>系統穩定性</strong>：5張切片在相同品質下，PSNR標準差 &lt; 2.5 dB，壓縮率標準差 &lt; 0.1:1。</p>

<hr />

<h2 id="6-限制與改進">6. 限制與改進</h2>

<h3 id="當前限制">當前限制</h3>

<ol>
<li><strong>區塊效應</strong>：8×8區塊可能產生邊界偽影（高壓縮時）</li>
<li><strong>固定量化</strong>：全影像使用同一量化矩陣，未考慮區域特性</li>
<li><strong>簡化Huffman</strong>：未利用係數間相關性</li>
</ol>

<h3 id="建議改進">建議改進</h3>

<p><strong>短期</strong>：添加邊界處理算法、後處理濾波<br />
<strong>中期</strong>：自適應量化、ROI機制<br />
<strong>長期</strong>：算術編碼、機器學習優化量化、GPU加速</p>

<hr />

<h2 id="7-結論">7. 結論</h2>

<p>本系統實現了功能完整的醫學影像壓縮編碼器：</p>

<p>✅ <strong>高效性</strong>：15.6:1壓縮率，保持50+ dB PSNR<br />
✅ <strong>可控性</strong>：品質參數提供49-61 dB範圍<br />
✅ <strong>穩定性</strong>：不同解剖位置表現一致<br />
✅ <strong>完整性</strong>：自包含格式，無外部依賴</p>

<p><strong>推薦配置</strong>：Quality 60提供最佳平衡（50.96 dB, 15.41:1），適合醫療存儲與傳輸應用。</p>

<hr />

<h2 id="附錄">附錄</h2>

<h3 id="a-檔案結構">A. 檔案結構</h3>

<pre><code>MMIP_hw2/
├── src/                    # 核心模組
│   ├── encode.py           # 編碼器
│   ├── decode.py           # 解碼器
│   ├── dct_transform.py    # DCT與量化
│   ├── huffman_coding.py   # Huffman編碼
│   └── bitstream.py        # 位元流格式
├── tools/                  # 評估工具
│   ├── evaluate_real_data.py
│   └── generate_visualizations.py
├── results_real/           # 實驗結果
│   ├── medimodel_results.json
│   ├── metrics_summary.csv
│   ├── performance_comparison.png
│   ├── rate_distortion_curve.png
│   └── qualitative_I150_Q60.png
└── docs/
    └── FINAL_REPORT.pdf
</code></pre>

<h3 id="b-使用範例">B. 使用範例</h3>

<p><strong>編碼</strong>：</p>

<pre><code>python3 src/encode.py --input input.dcm --output output.mdc --quality 60
</code></pre>

<p><strong>解碼</strong>：</p>

<pre><code>python3 src/decode.py --input output.mdc --output restored.raw
</code></pre>

<p><strong>評估</strong>：</p>

<pre><code>python3 tools/evaluate_real_data.py
</code></pre>

<h3 id="c-依賴套件">C. 依賴套件</h3>

<pre><code>numpy&gt;=1.20.0
scipy&gt;=1.7.0
pydicom&gt;=2.0.0
SimpleITK&gt;=2.0.0
matplotlib&gt;=3.3.0
scikit-image&gt;=0.19.0
</code></pre>

<hr />

<p><strong>報告完成</strong>: 2026年1月3日<br />
<strong>系統版本</strong>: v1.0<br />
<strong>實驗環境</strong>: Python 3.10, Ubuntu 22.04</p>

</body>
</html>